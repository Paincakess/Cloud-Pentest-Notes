---
title: STS (Assume Role)
updated: 2023-01-04 07:34:43Z
created: 2022-12-31 08:21:43Z
latitude: 27.71724530
longitude: 85.32396050
altitude: 0.0000
---

## sts:AssumeRole

Every role has a role trust policy that specifies who can assume the created role. For example,
The following role trust policy indicates that anyone can assume it, therefore any user will be able to escalate privilege to the permissions associated with that role.

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "AWS": "*"
            },
            "Action": "sts:AssumeRole"
        }
    ]
}
```

The role can be assumed with the following command:

- `aws sts assume-role --role-arn $ROLE_ARN --role-session-name sessionname`

## sts:AssumeRoleWithSAML

A trust policy with this role grants users authenticated via SAML access to impersonate the role.
An example of trust policy with this permission,

```
{
    "Version": "2022-12-15",
    "Statement": [
        {
            "Sid": "OneLogin",
            "Effect": "Allow",
            "Principal": {
                "Federated": "arn:aws:iam::290594632123:saml-provider/OneLogin"
            },
            "Action": "sts:AssumeRoleWithSAML",
            "Condition": {
                "StringEquals": {
                    "SAML:aud": "https://signin.aws.amazon.com/saml"
                }
            }
        }
    ]
}
```

To assume this role, use the following command,

- `aws sts assume-role-with-saml --role-arn <role_arn> --principal-arn <principal_arn>`
    Providers will also have their own tool for making it easier.
- `onelogin-aws-assume-role --onelogin-subdomain mettle --onelogin-app-id 283740 --aws-region eu-west-1 -z 3600`

## sts:AssumeRoleWithWebIdentity

This privilege grants permission to obtain a set of temporary credentials for users who have been authenticated in a mobile, web application, EKS with a web identity provider. There is official AWS docs about this web identity [here](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithWebIdentity.html).

For example, An IAM role can be assumed by an EKS service account, it will have a token in `/var/run/secrets/eks.amazonaws.com/serviceaccount/token` and can assume the role and get credentials using command like this:

- `aws sts assume-role-with-web-identity --role-arn arn:aws:iam::123456789098:role/<role_name> --role-session-name something --web-identity-token file:///var/run/secrets/eks.amazonaws.com/serviceaccount/token`

## Impact

The attackers will be able to assume role of higher privileges through this privilege.