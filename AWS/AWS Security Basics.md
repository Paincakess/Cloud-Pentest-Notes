# Organization Hierarchy
![8c4542467680b13bc2c57d11a88455af.png](_resources/8c4542467680b13bc2c57d11a88455af.png)

# Accounts
In AWS Environment there is a **Root Account**, which is basically an **parent container for all the accounts** in the organization. However, there is no need to use that account to deploy resources, you can create other aws accounts to separate different AWS infrastructures between them. One account will not able to access the resources from another account, *except if there is bridge created between the resources*.

There are two types of accounts in the organization.
- A single (root) account that is designated as the management account.
- And other are members accounts.

## Root Account
It is the account that you use to create the cloud environment for the organization, which has following persmissions,
- Create accounts in the organization
- Invite other existing accounts to the organization
- Remove accounts from the organization
- Manage invitations
- Apply policies to entities (roots, OUs, or accounts) within the organization
- Enable integration with supported AWS services to provide service functionality across all of the accounts in the organization.
- It's possible to login as the root user using the email and password used to create this root account/organization.
The root account has the responsibilities of a payer account and is responsible for paying all charges that are accrued by the member accounts, and the organization's management account cannot be changed.

**Note**: that a new admin user will have less permissions that the root user. From a security point of view, it's recommended to create other users and avoid using this one.

## Member Account
An account can be a member of only one organization at a time. You can attach a policy to an account to apply controls to only that one account.

# Amazon Resource Name (ARN)
It is the unique name every resource inside AWS has, its composed like this:
`arn:partition:service:region:account-id:resource-type/resource-id`
`arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env`

Note that there are 4 partitions in AWS but only 3 ways to call them:
AWS Standard: aws
AWS China: aws-cn
AWS US public Internet (GovCloud): aws-us-gov
AWS Secret (US Classified): aws

# Identity And Access Management (IAM)
IAM is the service that will allow you to manage Authentication, Authorization and Access Control inside your AWS account. AWS Identity and Access Management (IAM) provides fine-grained access control across all of AWS. With IAM, you can specify who can access which services and resources, and under which conditions. With IAM policies, you manage permissions to your workforce and systems to ensure least-privilege permissions.

**Authentication** - Process of defining an identity and the verification of that identity. This process can be subdivided in: Identification and verification.
**Authorization** - Determines what an identity can access within a system once it's been authenticated to it.
**Access Control** - The method and process of how access is granted to a secure resource
IAM can be defined by its ability to manage, control and govern authentication, authorization and access control mechanisms of identities to your resources within your AWS account.

## Functions in IAM
- There is a **Principal**, which can be Root user, IAM user and IAM role.
- **Policy** is like an Access Control List (ACL), which is attached to the **Principal**. 
- Policy Structure will be something like this `[Permission (Allow/Deny)+ Action + Resource + Conditions`
- **Conditions** are set in IAM policies to enforce restriction from unauthorized access, which can be even IP based!
![7770eef024bd9c93671dab7139cf6f5e.png](_resources/7770eef024bd9c93671dab7139cf6f5e.png)

## IAM Users
An IAM user is an entity that you create in AWS to represent the person or application that uses it to interact with AWS resources. When creating an IAM user,  the permissions are granted by making it a member of a user group that has appropriate permission policies attached (recommended), or by directly attaching policies to the user. 

## CLI (Access and Secret Keys)
**Access Key ID**: 20 random uppercase alphanumeric characters like AKHDNAPO86BSHKDIRYT
**Secret access key ID**: 40 random upper and lowercase characters: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU (It's not possible to retrieve lost secret access key IDs).

If there is need to change the Access Key this is the process you should follow:
Create a new access key -> Apply the new key to system/application -> mark original one as inactive -> Test and verify new access key is working -> Delete old access key

## IAM User Group
An IAM user group is a way to attach policies to multiple users at one time, which can make it easier to manage the permissions for those users. For example, **Identity-based policy** can be attached to a user group so that all of the users in the user group receive the policy's permissions.

Some important characteristics of user group:
- A user group can contain many users, and a user can belong to multiple groups.
- User groups can't be nested; they can contain only users, not other user groups.
- There is no default user group that automatically includes all users in the AWS account. If you want to have a user group like that, you must create it and assign each new user to it.


## IAM Role
An **IAM role** is very similar to a user, in that it is an identity with permission policies that determine what it can and cannot do in AWS. However, a role does not have any credentials (password or access keys) associated with it. Instead of being uniquely associated with one person, a role is intended to be assumable by anyone who needs it (and have enough perms). An IAM user can assume a role to temporarily take on different permissions for a specific task. A role can be assigned to a federated user who signs in by using an external identity provider instead of IAM.

## Temporary Credentials
It is primarly used with IAM roles, but there are also other used of temporary credentials temporary credentials.Temporary credentials that have a more restircted set of permissions than your standard IAM user, which prevents accidental privilleged tasks which are not permitted by the more restricted credentials. 
A benefit of temporary credentials is that they expire automatically after a set period of time, and the duration of those credentials can be set as needed.

## IAM Policies
It used to assign permissions to the enitites of AWS.
## Types of IAM Policies
- **Managed Policy**: This is a AWS system defined policies.
- **Inline Policy**: It a part of Principal itself, which can be edited. Inline policies are useful if you want to maintain a strict one-to-one relationship between a policy and the identity that it's applied to. The permissions in the policy cannot be inadvertently attached to the wrong identity.
- **Customer Managed Policy** : You can create policies based on AWS managed policies (modifying one of them and creating your own), using the policy generator.
- **Session Policies**

## IAM Boundaries
It is used to limit the **permission a user should have access to**. For example, even if the a different set of permissions are granted to the user by a different policy the operation will fail if the users try to use them.

## Identity Federation
It allows users from extrernal identity providers such as **Microsoft Active Directory(via SAML)** or **OpenID services (like Google)** to AWS to access AWS resources securly without having AWS user credentials. AWS Identity Federation connects via IAM roles.

# Permissions Required for AWS Pentest
These are the permissions you need on each AWS account you want to audit to be able to run all the proposed AWS audit tools:
The default policy `arn:aws:iam::aws:policy/ReadOnlyAccess`
