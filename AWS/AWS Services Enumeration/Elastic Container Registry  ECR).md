---
title: Elastic Container Registry  ECR)
updated: 2022-12-31 06:19:05Z
created: 2022-12-31 05:58:09Z
latitude: 27.71724530
longitude: 85.32396050
altitude: 0.0000
---

ECR is a managed container image registry service. Customers can use the familiar Docker CLI, or their preferred client, to push, pull, and manage images.

## Private repositories 
- The URI is what is used to reference the repository images while creating containers on ECS clusters. The URI is of the format `<account_id>.dkr.ecr.<region>.amazonaws.com/<repo-name>`
- The Tag immutability column lists its status, if tag immutability is enabled it will prevent image pushes with pre-existing tags from overwriting the images.
- The Encryption type column lists the encryption properties of the repository, it shows the default encryption types such as AES-256, or has KMS enabled encryptions.
- The Pull through cache column lists its status, if Pull through cache status is Active it will cache repositories in an external public repository into your private repository.
- Specific IAM policies can be configured to grant different permissions.
- The scanning configuration allows to scan for vulnerabilities in the images stored inside the repo.

## Public repositories:
The URI has a unique default alias like in: `public.ecr.aws/p3q0v3y2/alpine`

## General Enumeration
- List Repositories
	- `aws ecr describe-repositories`
- List Registries
	- `aws ecr describe-registry`
- List images inside a Repo
	- `aws ecr list-images --repository-name <repo_name>`
- Get details of the image
	- `aws ecr describe-images --repository-name <repo_name>`
- Get Replication Status of the Image
	- `aws ecr describe-image-replication-status --repository-name <repo_name> --image-id <image_id>`
- Get the scan findings for the specific image
	- `aws ecr describe-image-scan-findings --repository-name <repo_name> --image-id <image_id>`
- Return the pull through cache rules for a registry or image
	- `aws ecr describe-pull-through-cache-rules --repository-name <repo_name> --image-id <image_id>`

## Docker Functions
- Docker Login
	- `aws ecr get-login-password --profile <profile_name> --region <region> | docker login --username AWS --password-stdin <account_id>.dkr.ecr.<region>.amazonaws.com`

- Download image
	- `docker pull <UserID>.dkr.ecr.us-east-1.amazonaws.com/<ECRName>:latest`
- Get Details about the downloaded image
	- `docker inspect sha256:079aee8a89950717cdccd15b8f17c80e9bc4421a855fcdc120e1c534e4c102e0`
- Upload image 
	- `docker tag purplepanda:latest <account_id>.dkr.ecr.<region>.amazonaws.com/purplepanda:latest`
- Push Image]
	- `docker push <account_id>.dkr.ecr.<region>.amazonaws.com/purplepanda:latest`

## Downloading without Docker
- List Digests
	- `aws ecr batch-get-image --repository-name level2 --registry-id 653711331788 --image-ids imageTag=latest | jq '.images[].imageManifest | fromjson'`
- Downlaod Digest
	- `aws ecr get-download-url-for-layer --repository-name level2 --registry-id 653711331788 --layer-digest "sha256:edfaad38ac10904ee76c81e343abf88f22e6cfc7413ab5a8e4aeffc6a7d9087a"`
