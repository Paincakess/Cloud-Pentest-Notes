---
title: API Gateway
updated: 2022-12-30 08:36:46Z
created: 2022-12-30 07:03:55Z
latitude: 27.71724530
longitude: 85.32396050
altitude: 0.0000
---

Amazon API Gateway is a fully managed service that makes it easy for developers to create, publish, maintain, monitor, and secure APIs at any scale. APIs act as the "front door" for applications to access data, business logic, or functionality from your backend services.

## General Information
- List Accounts
	- `aws apigateway get-account`
- List domain names
	- `aws apigateway get-domain-names`
- Get Usage Plan
	- `aws apigateway get-usage-plans`
- Get VPC (Virtual Private Cloud) Link
	- `aws apigateway get-vpc-link`
- Get Client Certificates
	- `aws apigateway get-client-certificates`

## API Enumeration
- List REST APIs
	- `aws apigateway get-rest-apis`
- Get Stages of API
	- `aws apigateway get-stages --rest-api-id <id>`
- Get Resources of API
	- `aws apigateway get-resources --rest-api-id <id>`
- Get API resource action per HTTP Methods
	- `aws apigateway get-method --http-method <Method> --rest-api-id <id> --resource-id <resource_id>`
- Calling API
	- `
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>`
- Get API Authorizers
	- `aws apigateway get-authorizers --rest-api-id <id>`
- Get Models 
	- `aws apigateway get-models --rest-api-id <id>`

## Other Informations
- Get API responses
	- `aws apigateway get-gateway-responses --rest-api-id <id>`
- Get request validators
	- `aws apigateway get-request-validators --rest-api-id <id>`
- Get Deployements
	- `aws apigateway get-deployments --rest-api-id <id>`


# Vulnerabilities
## IAM access to APIs
It's possible to protect APIs with IAM-based authentication, but bad configurations might make an API accessible to all authenticated AWS users.
You will note that an API is expecting an IAM authorised token because it will send the response.
`{"message":"Missing Authentication Token"}`

One easy way to generate the expected token by the application is to use the **Authorization** type **AWS Signature** inside **Postman**.
![89a63633b511db9300d5e7a0318bbae8.png](../_resources/89a63633b511db9300d5e7a0318bbae8.png)

Set the `accessKey` and the `SecretKey` of the account you want to use and you can know authenticate against the API endpoint.
It will generate an Authorization header such as:
```
AWS4-HMAC-SHA256 Credential=AKIAYY7XU6ECUDOTWB7W/20220726/us-east-1/execute-api/aws4_request, SignedHeaders=host;x-amz-date, Signature=9f35579fa85c0d089c5a939e3d711362e92641e8c14cc571df8c71b4bc62a5c2
```
Note that in other cases the Authorizer might have been bad coded and just sending anything inside the Authorization header will allow to see the hidden content.

## Usage Plans DoS
In the Enumeration section you can see how to obtain the usage plan of the keys. If you have the key and it's limited to X usages per month, you could just use it and cause a DoS.
The API Key just need to be included inside a HTTP header called x-api-key