**Main Permissions needed for Enumeration**
- `iam:ListPolicies, iam:GetPolicy and iam:GetPolicyVersion`
- `iam:ListRoles`
- `iam:ListUsers`
- `iam:ListGroups`
- `iam:ListGroupsForUser`
- `iam:ListAttachedUserPolicies`
- `iam:ListAttachedRolePolicies`
- `iam:ListAttachedGroupPolicies`
- `iam:ListUserPolicies and iam:GetUserPolicy`
- `iam:ListGroupPolicies and iam:GetGroupPolicy`
- `iam:ListRolePolicies and iam:GetRolePolicy`


## All Details
Retrieves information about all IAM users, groups, roles and policies including their relationships to one another. Use this snapshot of the configuration of IAM permission in your account.
- `aws iam get-account-authorization-details`

## IAM Users
- List Users
	- `aws iam list-users`
- SSH public Keys
	- `aws iam list-ssh-public-keys`
- Get public key with metadata
	-  `aws iam get-ssh-public-key --user-name <username> --ssh-public-key-id <id> --encoding SSH` 
- Get special permissions of the IAM user over specific services
	- `aws iam list-service-specific-credentials`
- Get metadata of user
	- `aws iam get-user --user-name <username>`
- List created access keys
	- `aws iam-list-access-keys`
- Get policies attached to the user
	- `aws iam list-attached-user-policies --user-name <username>`
- Get inline policies of the user
	- `aws iam list-user-policies --user-name <username>`
- Get inline policy details
	- `aws iam get-user-policy --user-name <username> --policy-name <policy_name>`

## IAM Groups
- List groups
	- `aws iam list-groups` 
- Get groups of a user
	- `aws iam list-groups-for-user --user-name <username>`
- Get group name info
	- `aws iam get-group --group-name <name>`
- Get inline policies of the group 
	-`aws iam list-group-policies --group-name <username>`
- Get an inline policy info
	- `aws iam get-group-policy --group-name <username> --policy-name <policy_name>`
- Get policies attached to the group
	- `aws iam list-attached-group-policies --group-name <group_name>`

## IAM Role
- List roles
	- `aws iam list-roles`
- Get Role Information
	- `aws iam get-role --role-name <role_name>`
- Get inline policies of a role
	- `aws iam list-role-policies --role-name <name>`
- Get inline policy details
	- `aws iam get-role-policy --role-name <name> --policy-name <policy_name>` 
- Get policies attached to the role
	- `aws iam list-attached-role-policies --role-name <role-name>`

## IAM Policies
- List Policies
	- `aws iam list-policies [--only-attached] [--scope Local]`
- Get list of policies that give access to the user to the service.
	- `aws iam list-policies-granting-service-access --arn <identity> --service-namespaces <svc>`
- Get policy content
	- `aws iam get-policy --policy-arn <policy_arn>`
- List Policy Versions
	- `aws iam list-policy-versions --policy-arn <arn>`
- Get Details about version of policies
	- `aws iam get-policy-version --policy-arn <arn:aws:iam::975426262029:policy/list_apigateways> --version-id <VERSION_X>`

## IAM Cognito Provider
- SAML Provider
	- `aws iam list-saml-providers`
	- `aws iam get-saml-provider --saml-provider-arn <ARN>`
- OPEN ID Connect
	- `aws iam list-open-id-connect-providers`
	- `aws iam get-open-id-connect-provider --open-id-connect-provider-arn <ARN>`

## Other Enumerations
- Get password policy
	- `aws iam get-account-password-policy`
- List MFA devices 
	- `aws iam list-mfa-devices`
- Virtual MFA Devices
	- `aws iam list-virtual-mfa-devices`

## Useful Tools for IAM Enumeration
### Enumerate-iam
If interested in your own permissions but you don't have access to query IAM you could always brute-force them using
**[Download](https://github.com/andresriancho/enumerate-iam)**
 ```
git clone git@github.com:andresriancho/enumerate-iam.git
cd enumerate-iam/
pip install -r requirements.txt
 ```
 
- `./enumerate-iam.py --access-key <access_key> --secret-key <secret_key>`

### weridAAL
This tool will indicate and output the actions you can perform in the most common AWS services.
**[Download](https://github.com/carnal0wnage/weirdAAL.git)**
```
git clone https://github.com/carnal0wnage/weirdAAL.git
cd weirdAAL
python3 -m venv weirdAAL
source weirdAAL/bin/activate
pip3 install -r requirements.txt

# Create a .env file with aws credentials such as
[default]
aws_access_key_id = <insert key id>
aws_secret_access_key = <insert secret key>
```
 
- `python3 weirdAAL.py -m recon_all -t MyTarget` 
 
# Post-Exploitation
## From IAM Creds to Console
if you have managed to obtain some IAM credentials you might be interested on accessing the web console. You can generate a web console link with **[aws_consoler](https://github.com/NetSPI/aws_consoler)** tool.

```
cd /tmp
python3 -m venv env
source ./env/bin/activate
pip install aws-consoler
aws_consoler [params...]
```
 
